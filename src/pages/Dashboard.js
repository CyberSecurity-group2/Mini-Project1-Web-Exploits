import React, { useContext, useState } from "react";
import { AuthContext } from "../context/auth";

import Row from 'react-bootstrap/Row'
import Col from 'react-bootstrap/Col'
import Jumbotron from 'react-bootstrap/Jumbotron'
import Button from 'react-bootstrap/Button'

function Dashboard() {
  const [username, setUsername] = useState();
  const [userID, setUserId] = useState();
  const [password, setPassword] = useState();

  function encodeID(num){
    // return "852456"+ num + "159357";
    return num;
  }

  var {
    user
  } = useContext(AuthContext);

  function handleSubmit(event){
    event.preventDefault();
    // var url = new URL("http://localhost:8080/getUser"),
    var url = new URL("https://securityproject-270814.appspot.com/getUser"),
      params = {id: encodeID(user)}
    Object.keys(params).forEach(key => url.searchParams.append(key, params[key]))
    fetch(url, {
      method: 'GET'
    })
      .then(res => res.json())
      .then(res => {
        if(res.success){
          setUsername(res.data.id);
          setUserId(res.data.id);
          setPassword(res.data.password);
        }
      })

  }

  const context = useContext(AuthContext);
  return (
    <>
      <h1 style={{textAlign: 'center'}}>Dashboard</h1>
      <div style={{height: '100%'}}>
      <Row>
        <Col sm={6}>
          <Jumbotron>
            <h4>SQL Injection</h4>

          </Jumbotron>
        </Col>
        <Col sm={6}>
          <Jumbotron>
            <h4>IDOR</h4>
            <Button onClick={handleSubmit}>PRESS HERE TO SEE YOUR INFO</Button>
            {username ? <h1>Your username is {username}</h1> : <></>}
            {userID ? <h1>Your user ID is {userID}</h1> : <></>}
            {password ? <h1>Your user password is {password}</h1> : <></>}
          </Jumbotron>
        </Col>
      </Row>
      <Row>
        <Col sm={6}>
          <Jumbotron>
            <h4>other</h4>
          </Jumbotron>
        </Col>
        <Col sm={6}>
          <Jumbotron>
            <h4>XSS</h4>

          </Jumbotron>
        </Col>
      </Row>
      <h3 onClick={ () => {context.logout()}}>Logout</h3>
      </div>
    </>
  );
}

export default Dashboard;
